# INSTALLATION GUIDE

## Configuration of the virtual machine
We worked inside the PACS virtual machine. At every restart we loaded the modules before running any program.

## Download and installation of IsoGlib
Download IsoGlib library from the provided link (private on bitbucket.org) and switch to branch `Learning_pacs_anedp_project_guido_vidulis`.

### Compilation
The first step is the configuration of the enviroment.
If you are running the PACS virtual machine just rename the file `isoglib/settings_PACS_vm.sh` into
`isoglib/settings.sh` and everything should work fine.
Otherwise, the file `isoglib/settings_empty.sh` needs to be renamed as before and filled with the libraries locations.
Then type:

+ `source configure.sh`

By default the release version of the library is built, so, once the script ends running,
you should be located inside `isoglib/BuildRelease`. In that folder type:

+ `cmake ..`
+ `make`

**Warning 1**: during the compilation an error involving the file `HYPRE_IJ_mv.h` could appear.
We solved by locating the file and adding it to `CPATH`:

+ `export CPATH="$CPATH:/u/sw/pkgs/toolchains/gcc-glibc/7/pkgs/hypre/2.11.2/include"`


**Warning 2**: it could be necessary to remove the file `isoglib/isoglib/isoglib_config.hpp` before every new compilation.
The file is generated by error and causes problems with the definition of the macro USE_MPI during the compilation of the library.

## Download and installation of OpenNN
Download OpenNN from https://github.com/margheguido/OpenNN.git.

**Important**: Clone OpenNN in the same folder of IsoGlib since linking phase have been tested only in these conditions, otherwise the path to isoglib folder has to be changed in line 43-44 of ``OpenNN/CMakeLists.txt``

### Compilation
Inside `OpenNN/` type:
+ `mkdir build`
+ `cd build`
+ `cmake ..`
+ `make`

The library comes with some examples (`OpenNN/examples`).
We implemented the Neural Network as a new example named SUPG (folder `OpenNN/examples/SUPG`) which will be built automatically.

## How to use the provided test
* The possible dataset are stored in the folder `OpenNN/PACS_ANEDP_Project/DatasetGenerationSUPGDataset`.
To understand how they are labeled and how to generate new ones, read the file `OpenNN/PACS_ANEDP_Project/README.md`.
To use one of them, it has to be renamed as `SUPG.txt` and placed in `OpenNN/build/examples/SUPG/data/Test(1 or 2)`
(or in`OpenNN/examples/SUPG/data/Test(1 or 2)` before recompilation).

* To run the test and obtain the output on a txt file, type ( in `OpenNN/build/examples/SUPG`) `./SUPG > output.txt`.
This file will contain the full output, including the information written by IsoGlib during the solving process.
To see the actual training process state search for the keyword "Epoch".
What we used for the PostProcessing phase, are the values printed in the end of the file:

    - `Training error`
    - `Validation error`
    - `[Input] Mu`
    - `[Output] Unscaled tau`
    - `Predicted tau for EDP`

  To use them for PostProcessing, they have to be copied in a new file placed in `OpenNN/PACS_ANEDP_Project/SUPGOutput`
  (see `OpenNN/PACS_ANEDP_Project/README.md` for more details)

NB: We worked on the PACS virtual machine, so everything have been tested only inside that enviroment.
